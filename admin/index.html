<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Tech Gateway</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { 
      --primary: #00d4ff; 
      --secondary: #00ff88; 
      --accent: #ff6b6b; 
      --dark: #0a0e17; 
      --darker: #050810; 
      --panel: #111827; 
      --panel-hover: #1a2332;
      --text: #e2e8f0; 
      --text-muted: #94a3b8; 
      --border: #1e293b;
      --glow: 0 0 20px rgba(0, 212, 255, 0.3);
    }
    html, body { height: 100%; overflow: hidden; }
    body { font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace; background: var(--dark); color: var(--text); }
    
    /* Login Overlay */
    .login-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--darker); display: flex; align-items: center; justify-content: center; z-index: 9999; }
    .login-overlay.hidden { display: none; }
    .login-box { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 40px; width: 100%; max-width: 400px; text-align: center; box-shadow: var(--glow); }
    .login-box h2 { color: var(--primary); margin-bottom: 10px; letter-spacing: 2px; }
    .login-box p { color: var(--text-muted); margin-bottom: 30px; font-size: 0.9rem; }
    .login-box input { width: 100%; padding: 15px; background: var(--darker); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 1rem; font-family: inherit; text-align: center; margin-bottom: 20px; transition: all 0.3s; }
    .login-box input:focus { outline: none; border-color: var(--primary); box-shadow: var(--glow); }
    .login-box input::placeholder { color: var(--text-muted); }
    .login-error { color: var(--accent); margin-top: 15px; font-size: 0.9rem; display: none; }
    .login-error.show { display: block; }
    
    /* Admin Layout */
    #admin-container { display: none; height: 100vh; }
    #admin-container.visible { display: flex; }
    .sidebar { width: 250px; background: var(--panel); border-right: 1px solid var(--border); padding: 20px 0; flex-shrink: 0; overflow-y: auto; }
    .sidebar-header { padding: 0 20px 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
    .sidebar-header h2 { font-size: 1.3rem; color: var(--primary); text-shadow: var(--glow); letter-spacing: 2px; }
    .sidebar-header span { color: var(--secondary); }
    .sidebar-nav { list-style: none; }
    .sidebar-nav li { margin-bottom: 5px; }
    .sidebar-nav a { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: var(--text-muted); text-decoration: none; transition: all 0.3s; font-size: 0.9rem; letter-spacing: 1px; cursor: pointer; }
    .sidebar-nav a:hover, .sidebar-nav a.active { background: rgba(0, 212, 255, 0.1); color: var(--primary); border-left: 2px solid var(--primary); }
    .sidebar-nav a:hover { text-shadow: var(--glow); }
    .main-content { flex: 1; padding: 30px; overflow-y: auto; background: var(--dark); }
    
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .page-header h1 { font-size: 1.8rem; color: var(--primary); text-shadow: var(--glow); letter-spacing: 1px; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: var(--panel); border-radius: 12px; padding: 25px; border: 1px solid var(--border); transition: all 0.3s; }
    .stat-card:hover { border-color: var(--primary); box-shadow: var(--glow); }
    .stat-card .label { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 8px; letter-spacing: 1px; }
    .stat-card .value { font-size: 2rem; font-weight: 700; color: var(--secondary); text-shadow: 0 0 10px rgba(0, 255, 136, 0.3); }
    .card { background: var(--panel); border-radius: 12px; padding: 25px; margin-bottom: 20px; border: 1px solid var(--border); }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
    .card-header h3 { font-size: 1.2rem; color: var(--primary); letter-spacing: 1px; }
    .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.3s; letter-spacing: 1px; }
    .btn-primary { background: linear-gradient(90deg, var(--primary), var(--secondary)); color: var(--dark); }
    .btn-primary:hover { box-shadow: var(--glow); transform: translateY(-2px); }
    .btn-success { background: linear-gradient(90deg, var(--secondary), #00cc6a); color: var(--dark); }
    .btn-success:hover { box-shadow: 0 0 20px rgba(0, 255, 136, 0.4); transform: translateY(-2px); }
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border); }
    th { font-weight: 600; color: var(--primary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; }
    tr:hover { background: rgba(0, 212, 255, 0.05); }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; letter-spacing: 1px; }
    .badge-success { background: rgba(0, 255, 136, 0.1); color: var(--secondary); border: 1px solid rgba(0, 255, 136, 0.3); }
    .badge-warning { background: rgba(255, 193, 7, 0.1); color: #ffc107; border: 1px solid rgba(255, 193, 7, 0.3); }
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .quick-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-muted); letter-spacing: 1px; }
    .form-group select, .form-group input { width: 100%; padding: 12px; background: var(--darker); border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; color: var(--text); font-family: inherit; transition: all 0.3s; }
    .form-group select:focus, .form-group input:focus { outline: none; border-color: var(--primary); box-shadow: var(--glow); }
    .article-title-cell { max-width: 300px; }
    .article-title-cell a { color: var(--primary); text-decoration: none; transition: all 0.3s; }
    .article-title-cell a:hover { text-shadow: var(--glow); }
    .quick-link { color: var(--primary); text-decoration: none; font-weight: 600; transition: all 0.3s; cursor: pointer; }
    .quick-link:hover { text-shadow: var(--glow); }
    
    @media (max-width: 768px) { 
      .sidebar { display: none; }
      .grid-2 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Password Login Overlay -->
  <div class="login-overlay" id="login-overlay">
    <div class="login-box">
      <h2>> TECH GATEWAY ADMIN</h2>
      <p>High-End Gaming & PC Hardware Reviews</p>
      <input type="password" id="admin-password" placeholder="PASSWORD" onkeypress="if(event.key==='Enter')checkPassword()">
      <button class="btn btn-primary" style="width: 100%;" onclick="checkPassword()">UNLOCK</button>
      <p class="login-error" id="login-error">> ACCESS DENIED - INVALID PASSWORD</p>
    </div>
  </div>

  <!-- Admin Container -->
  <div id="admin-container">
    <nav class="sidebar">
      <div class="sidebar-header">
        <h2>AFFILIATE<span>HUB</span></h2>
      </div>
      <ul class="sidebar-nav">
        <li><a href="#" class="active" onclick="showPage('dashboard')">üìä DASHBOARD</a></li>
        <li><a href="#" onclick="showPage('articles')">üìù ARTICLES</a></li>
        <li><a href="#" onclick="showPage('generate')">‚ö° GENERATE</a></li>
        <li><a href="#" onclick="showPage('affiliate')">üí∞ STATS</a></li>
        <li><a href="#" onclick="showPage('settings')">‚öôÔ∏è SETTINGS</a></li>
        <li><a href="/">üåê VIEW SITE</a></li>
      </ul>
    </nav>

    <main class="main-content">
      <!-- Dashboard Page -->
      <div id="page-dashboard">
        <div class="page-header">
          <h1>> DASHBOARD</h1>
          <div class="quick-actions">
            <button class="btn btn-success" onclick="triggerGeneration()">üöÄ GENERATE ARTICLES</button>
            <button class="btn btn-primary" onclick="runOptimization()">üîß RUN SEO</button>
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="label">TOTAL ARTICLES</div>
            <div class="value" id="stat-articles">0</div>
          </div>
          <div class="stat-card">
            <div class="label">TOTAL EARNINGS</div>
            <div class="value" id="stat-earnings">$0.00</div>
          </div>
          <div class="stat-card">
            <div class="label">PENDING PAYOUTS</div>
            <div class="value" id="stat-pending">$0.00</div>
          </div>
          <div class="stat-card">
            <div class="label">CONVERSION RATE</div>
            <div class="value" id="stat-conversion">0%</div>
          </div>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h3>> TOP PERFORMING PRODUCTS</h3>
            </div>
            <div class="table-container">
              <table>
                <thead>
                  <tr><th>PRODUCT</th><th>EARNINGS</th></tr>
                </thead>
                <tbody id="top-products"></tbody>
              </table>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h3>> EARNINGS BY CATEGORY</h3>
            </div>
            <div id="category-earnings">
              <p style="color: #64748b;">> No data available...</p>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>> RECENT ARTICLES</h3>
            <a href="#" class="quick-link" onclick="showPage('articles')">VIEW ALL >></a>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr><th>TITLE</th><th>CATEGORY</th><th>DATE</th><th>STATUS</th></tr>
              </thead>
              <tbody id="recent-articles"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Articles Page -->
      <div id="page-articles" style="display: none;">
        <div class="page-header">
          <h1>> ALL ARTICLES</h1>
          <button class="btn btn-success" onclick="showPage('generate')">+ NEW ARTICLE</button>
        </div>
        <div class="card">
          <div class="table-container">
            <table>
              <thead>
                <tr><th>TITLE</th><th>CATEGORY</th><th>KEYWORDS</th><th>DATE</th><th>ACTIONS</th></tr>
              </thead>
              <tbody id="all-articles"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Generate Page -->
      <div id="page-generate" style="display: none;">
        <div class="page-header">
          <h1>> GENERATE CONTENT</h1>
        </div>
        <div class="card">
          <form id="generate-form">
            <div class="form-group">
              <label>SELECT NICHE</label>
              <select id="niche-select">
                <option value="ai-tech">AI/TECH TOOLS</option>
                <option value="crypto">CRYPTOCURRENCY</option>
                <option value="productivity">PRODUCTIVITY SOFTWARE</option>
                <option value="home-garden">HOME & GARDEN</option>
              </select>
            </div>
            <div class="form-group">
              <label>KEYWORDS (comma-separated, optional)</label>
              <input type="text" id="keywords-input" placeholder="e.g., AI writing, chatbot, automation">
            </div>
            <button type="submit" class="btn btn-success">‚ö° GENERATE ARTICLE</button>
          </form>
        </div>
        <div class="card" id="generated-result" style="display: none;">
          <div class="card-header">
            <h3>> GENERATED ARTICLE</h3>
          </div>
          <div id="generated-content"></div>
        </div>
      </div>

      <!-- Affiliate Page -->
      <div id="page-affiliate" style="display: none;">
        <div class="page-header">
          <h1>> AFFILIATE STATISTICS</h1>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="label">TOTAL CLICKS</div>
            <div class="value" id="aff-clicks">0</div>
          </div>
          <div class="stat-card">
            <div class="label">CONVERSIONS</div>
            <div class="value" id="aff-conversions">0</div>
          </div>
          <div class="stat-card">
            <div class="label">TOTAL REVENUE</div>
            <div class="value" id="aff-revenue">$0.00</div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3>> NETWORK PERFORMANCE</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr><th>NETWORK</th><th>EARNINGS</th></tr>
              </thead>
              <tbody id="network-performance"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div id="page-settings" style="display: none;">
        <div class="page-header">
          <h1>> SETTINGS</h1>
        </div>
        <div class="card">
          <div class="card-header">
            <h3>> CONFIGURATION</h3>
          </div>
          <form id="settings-form">
            <div class="form-group">
              <label>SITE URL</label>
              <input type="text" id="site-url" value="http://localhost:3000">
            </div>
            <div class="form-group">
              <label>AMAZON ASSOCIATES TAG</label>
              <input type="text" id="amazon-tag" placeholder="your-tag-20">
            </div>
            <div class="form-group">
              <label>BINANCE REFERRAL ID</label>
              <input type="text" id="binance-ref" placeholder="Your Binance ID">
            </div>
            <div class="form-group">
              <label>OPENAI API KEY</label>
              <input type="password" id="openai-key" placeholder="sk-...">
            </div>
            <button type="submit" class="btn btn-primary">SAVE SETTINGS</button>
          </form>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Password Authentication
    const ADMIN_PASSWORD = 'poploop';
    let isAuthenticated = false;

    // Check if already authenticated in this session
    if (sessionStorage.getItem('adminAuth') === 'true') {
      isAuthenticated = true;
      showAdminContent();
    }

    function checkPassword() {
      const input = document.getElementById('admin-password').value;
      const errorMsg = document.getElementById('login-error');
      
      if (input === ADMIN_PASSWORD) {
        isAuthenticated = true;
        sessionStorage.setItem('adminAuth', 'true');
        showAdminContent();
      } else {
        errorMsg.classList.add('show');
        document.getElementById('admin-password').value = '';
        document.getElementById('admin-password').focus();
      }
    }

    function showAdminContent() {
      document.getElementById('login-overlay').classList.add('hidden');
      document.getElementById('admin-container').classList.add('visible');
      loadDashboard();
    }

    // Navigation
    function showPage(page) {
      ['dashboard', 'articles', 'generate', 'affiliate', 'settings'].forEach(p => {
        document.getElementById('page-' + p).style.display = p === page ? 'block' : 'none';
      });
      document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
      event.target.closest('a')?.classList.add('active');
      if (page === 'dashboard') loadDashboard();
      if (page === 'articles') loadAllArticles();
      if (page === 'affiliate') loadAffiliateStats();
    }

    // Load dashboard
    async function loadDashboard() {
      try {
        const [statsRes, articlesRes] = await Promise.all([
          fetch('/api/admin/stats'),
          fetch('/api/articles')
        ]);
        const stats = await statsRes.json();
        const articles = await articlesRes.json();

        document.getElementById('stat-articles').textContent = stats.totalArticles;
        document.getElementById('stat-earnings').textContent = '$' + stats.totalEarnings;
        document.getElementById('stat-pending').textContent = '$' + stats.pendingPayouts;
        document.getElementById('stat-conversion').textContent = stats.conversionRate + '%';

        // Top products
        const topProducts = stats.topPerformers || [];
        document.getElementById('top-products').innerHTML = topProducts.map(p => 
          `<tr><td>${p.product}</td><td style="color: var(--secondary);">$${p.earnings}</td></tr>`
        ).join('') || '<tr><td colspan="2">> No data yet...</td></tr>';

        // Recent articles
        const recent = articles.slice(0, 5);
        document.getElementById('recent-articles').innerHTML = recent.map(a => `
          <tr>
            <td class="article-title-cell"><a href="#">${a.title}</a></td>
            <td><span class="badge badge-success">${a.niche || a.category}</span></td>
            <td>${new Date(a.date).toLocaleDateString()}</td>
            <td><span class="badge badge-success">PUBLISHED</span></td>
          </tr>
        `).join('') || '<tr><td colspan="4">> No articles yet...</td></tr>';

        // Category earnings
        const categoryDiv = document.getElementById('category-earnings');
        if (stats.byCategory && Object.keys(stats.byCategory).length > 0) {
          categoryDiv.innerHTML = Object.entries(stats.byCategory).map(([cat, amount]) => `
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); color: var(--text-muted);">
              <span>${cat}</span>
              <strong style="color: var(--secondary);">$${amount.toFixed(2)}</strong>
            </div>
          `).join('');
        }
      } catch (error) {
        console.error('Error loading dashboard:', error);
      }
    }

    // Load all articles
    async function loadAllArticles() {
      try {
        const res = await fetch('/api/articles');
        const articles = await res.json();
        document.getElementById('all-articles').innerHTML = articles.map(a => `
          <tr>
            <td class="article-title-cell"><a href="#">${a.title}</a></td>
            <td><span class="badge badge-success">${a.niche || a.category}</span></td>
            <td>${(a.keywords || []).slice(0, 3).join(', ')}</td>
            <td>${new Date(a.date).toLocaleDateString()}</td>
            <td><button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;">EDIT</button></td>
          </tr>
        `).join('') || '<tr><td colspan="5">> No articles yet. Generate some content!</td></tr>';
      } catch (error) {
        console.error('Error loading articles:', error);
      }
    }

    // Generate article
    document.getElementById('generate-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const niche = document.getElementById('niche-select').value;
      const keywords = document.getElementById('keywords-input').value.split(',').map(k => k.trim()).filter(k => k);
      
      try {
        const res = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ niche, keywords })
        });
        const data = await res.json();
        
        if (data.success) {
          document.getElementById('generated-result').style.display = 'block';
          document.getElementById('generated-content').innerHTML = `
            <h2 style="color: var(--primary); margin-bottom: 15px;">${data.article.title}</h2>
            <p style="color: var(--text-muted); margin-bottom: 10px;"><strong>CATEGORY:</strong> ${data.article.niche}</p>
            <p style="color: var(--text-muted); margin-bottom: 10px;"><strong>KEYWORDS:</strong> ${data.article.keywords.join(', ')}</p>
            <p style="color: var(--text-muted); margin-bottom: 20px;"><strong>SLUG:</strong> ${data.article.slug}</p>
            <hr style="margin: 20px 0; border-color: var(--border);">
            <div style="color: var(--text);">${data.article.content}</div>
          `;
        }
      } catch (error) {
        console.error('Generation error:', error);
      }
    });

    // Trigger generation
    async function triggerGeneration() {
      if (!confirm('Run automated content generation? This will create 8-12 new articles.')) return;
      
      try {
        const res = await fetch('/api/admin/trigger-generate', { method: 'POST' });
        const data = await res.json();
        alert(`Successfully generated ${data.generated} articles!`);
        loadDashboard();
      } catch (error) {
        alert('Generation failed: ' + error.message);
      }
    }

    // Run SEO optimization
    async function runOptimization() {
      try {
        const res = await fetch('/api/optimize', { method: 'POST' });
        const data = await res.json();
        alert(data.message);
      } catch (error) {
        alert('Optimization failed: ' + error.message);
      }
    }

    // Load affiliate stats
    async function loadAffiliateStats() {
      try {
        const res = await fetch('/api/affiliate/stats');
        const stats = await res.json();
        
        document.getElementById('aff-clicks').textContent = stats.totalClicks;
        document.getElementById('aff-conversions').textContent = stats.totalConversions;
        document.getElementById('aff-revenue').textContent = '$' + stats.totalEarnings;

        if (stats.byNetwork) {
          document.getElementById('network-performance').innerHTML = Object.entries(stats.byNetwork).map(([net, amount]) => 
            `<tr><td>${net}</td><td style="color: var(--secondary);">$${amount.toFixed(2)}</td></tr>`
          ).join('');
        }
      } catch (error) {
        console.error('Error loading affiliate stats:', error);
      }
    }
  </script>
</body>
</html>
